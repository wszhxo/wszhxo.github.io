# 微信小程序消息推送

> 微信小程序的推送消息是在服务通知收到的
>
> 文档https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html#%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF%E8%AF%AD%E9%9F%B3%E6%8F%90%E9%86%92



1. 需要进入开发者平台**开通订阅消息**，并且**创建模板**。

2. 小程序需要调起客户端小程序订阅消息界面，只有订阅了才能收到通知 

   ![image-20220727155354092](https://zhanghx.oss-cn-beijing.aliyuncs.com/typora/image-20220727155354092.png)

   文档 https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html 

3. 小程序获取临时code，用于换取openid，用户标识推送就是通过它

   文档  https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html 

4. 获取accesstoken  这是发送消息所需的参数  ，输入appid和secret即可得到

   ```java
   GET https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=&secret=
   ```

5. 使用第三四步骤的openid和accesstoken  就可以发送消息了，会在服务通知中收到提醒

   ```json
   post https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=
   
   还有下边的json ，data就是模板中需要的参数
   {
     "touser": "openid",
     "template_id": "模板id",
       "page": "点击跳转的页面",
     "data": {
         "date2": {
             "value": "2015年01月05日"
         },
         "thing4": {
             "value": "TIT创意园"
         } ,
         "thing1": {
             "value": "广州市新港中路397号"
         }
     }
   }
   ```

   

![image-20220727155028576](https://zhanghx.oss-cn-beijing.aliyuncs.com/typora/image-20220727155028576.png)





